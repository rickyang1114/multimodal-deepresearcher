<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Strategic Implementation Pathways for Advanced Plastic Recycling</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Arial', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            padding: 0;
        }
        
        .visualization-container {
            width: 1000px;
            height: 1000px;
            position: relative;
        }
        
        .title {
            text-align: center;
            font-size: 26px;
            font-weight: bold;
            margin-bottom: 20px;
        }
        
        .axis-label {
            font-size: 16px;
            font-weight: bold;
        }
        
        .quadrant-label {
            font-size: 14px;
            fill: #333;
            text-anchor: middle;
            font-weight: bold;
        }
        
        .bubble-label {
            font-size: 12px;
            pointer-events: none;
            font-weight: bold;
        }
        
        .annotation {
            font-size: 11px;
            fill: #555;
            font-style: italic;
        }
        
        .key-number {
            font-family: 'Georgia', serif;
            font-weight: bold;
            font-size: 12px;
        }
        
        .source {
            font-size: 12px;
            fill: #666;
            text-anchor: start;
        }
        
        .legend-title {
            font-size: 14px;
            font-weight: bold;
        }
        
        .legend-item {
            font-size: 12px;
        }
        
        .quadrant {
            fill-opacity: 0.08;
        }
        
        .bubble-icon {
            font-size: 14px;
            fill: white;
            text-anchor: middle;
            dominant-baseline: central;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="visualization-container" id="visualization"></div>

    <script>
        // SVG setup - Increased dimensions
        const margin = { top: 60, right: 120, bottom: 80, left: 80 };
        const width = 1000 - margin.left - margin.right;
        const height = 1000 - margin.top - margin.bottom;
        
        const svg = d3.select("#visualization")
            .append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform", `translate(${margin.left}, ${margin.top})`);
            
        // Title
        svg.append("text")
            .attr("class", "title")
            .attr("x", width / 2)
            .attr("y", -30)
            .attr("text-anchor", "middle")
            .text("Strategic Implementation Pathways for Advanced Plastic Recycling");
            
        // Define scales
        const xScale = d3.scaleLinear()
            .domain([0, 100])
            .range([0, width]);
            
        const yScale = d3.scaleLinear()
            .domain([0, 100])
            .range([height, 0]);
            
        // Draw axes
        svg.append("line")
            .attr("x1", 0)
            .attr("y1", height / 2)
            .attr("x2", width)
            .attr("y2", height / 2)
            .attr("stroke", "#333")
            .attr("stroke-width", 1.5);
            
        svg.append("line")
            .attr("x1", width / 2)
            .attr("y1", 0)
            .attr("x2", width / 2)
            .attr("y2", height)
            .attr("stroke", "#333")
            .attr("stroke-width", 1.5);
            
        // Axis labels
        // X-axis labels
        svg.append("text")
            .attr("class", "axis-label")
            .attr("x", width / 4)
            .attr("y", height + 40)
            .attr("text-anchor", "middle")
            .text("Near-term (1-3 years)");
            
        svg.append("text")
            .attr("class", "axis-label")
            .attr("x", 3 * width / 4)
            .attr("y", height + 40)
            .attr("text-anchor", "middle")
            .text("Long-term (5+ years)");
            
        svg.append("text")
            .attr("class", "axis-label")
            .attr("x", width / 2)
            .attr("y", height + 65)
            .attr("text-anchor", "middle")
            .text("Implementation Timeline");
            
        // Y-axis labels - CORRECTED: Proper orientation with Higher Impact at top
        svg.append("text")
            .attr("class", "axis-label")
            .attr("transform", "rotate(-90)")
            .attr("x", -height * 3/4)
            .attr("y", -50)
            .attr("text-anchor", "middle")
            .text("Lower Impact");
            
        svg.append("text")
            .attr("class", "axis-label")
            .attr("transform", "rotate(-90)")
            .attr("x", -height/4)
            .attr("y", -50)
            .attr("text-anchor", "middle")
            .text("Higher Impact");
            
        svg.append("text")
            .attr("class", "axis-label")
            .attr("transform", "rotate(-90)")
            .attr("x", -height/2)
            .attr("y", -70)
            .attr("text-anchor", "middle")
            .text("Impact Level");
            
        // Quadrant backgrounds
        svg.append("rect")
            .attr("class", "quadrant")
            .attr("x", 0)
            .attr("y", 0)
            .attr("width", width / 2)
            .attr("height", height / 2)
            .attr("fill", "#4682B4");
            
        svg.append("rect")
            .attr("class", "quadrant")
            .attr("x", width / 2)
            .attr("y", 0)
            .attr("width", width / 2)
            .attr("height", height / 2)
            .attr("fill", "#6B8E23");
            
        svg.append("rect")
            .attr("class", "quadrant")
            .attr("x", 0)
            .attr("y", height / 2)
            .attr("width", width / 2)
            .attr("height", height / 2)
            .attr("fill", "#CD853F");
            
        svg.append("rect")
            .attr("class", "quadrant")
            .attr("x", width / 2)
            .attr("y", height / 2)
            .attr("width", width / 2)
            .attr("height", height / 2)
            .attr("fill", "#8B4513");
            
        // Quadrant labels - CORRECTED: Proper positioning
        svg.append("text")
            .attr("class", "quadrant-label")
            .attr("x", width / 4)
            .attr("y", height / 4 - 20)
            .text("High Impact, Near-term");
            
        svg.append("text")
            .attr("class", "quadrant-label")
            .attr("x", 3 * width / 4)
            .attr("y", height / 4 - 20)
            .text("High Impact, Long-term");
            
        svg.append("text")
            .attr("class", "quadrant-label")
            .attr("x", width / 4)
            .attr("y", 3 * height / 4 - 20)
            .text("Low Impact, Near-term");
            
        svg.append("text")
            .attr("class", "quadrant-label")
            .attr("x", 3 * width / 4)
            .attr("y", 3 * height / 4 - 20)
            .text("Low Impact, Long-term");
            
        // CORRECTED: Data for bubbles with proper positioning according to specifications
        const data = [
            // Policy factors (blue)
            { id: 1, name: "Landfill bans", x: 20, y: 15, radius: 25, category: "policy", 
              annotation: "Countries with bans achieve <10% landfilling vs >50% in countries without" },
            { id: 2, name: "Recycled content mandates", x: 25, y: 20, radius: 22, category: "policy" },
            { id: 3, name: "Extended Producer Responsibility", x: 45, y: 15, radius: 24, category: "policy" },
            { id: 4, name: "Harmonized sorting standards", x: 50, y: 45, radius: 20, category: "policy" },
            
            // Technology factors (teal)
            { id: 5, name: "Scale-up of STRAP process", x: 30, y: 30, radius: 22, category: "technology", 
              annotation: "MSP drops from $1.19/kg to $0.60/kg at 15,000 t/yr" },
            { id: 6, name: "Commercial pyrolysis expansion", x: 25, y: 60, radius: 20, category: "technology" },
            { id: 7, name: "Design-for-circularity implementation", x: 55, y: 20, radius: 24, category: "technology" },
            { id: 8, name: "Bio-based layers development", x: 75, y: 30, radius: 22, category: "technology" },
            
            // Infrastructure factors (green)
            { id: 9, name: "Improved multilayer film collection", x: 30, y: 65, radius: 20, category: "infrastructure", 
              annotation: "Currently only ~1% of Americans have curbside film pickup" },
            { id: 10, name: "Decentralized processing facilities", x: 60, y: 60, radius: 20, category: "infrastructure" },
            { id: 11, name: "Integrated chemical recycling parks", x: 80, y: 20, radius: 24, category: "infrastructure" },
            
            // Market factors (orange)
            { id: 12, name: "Tipping-fee incentives", x: 20, y: 55, radius: 20, category: "market", 
              annotation: "Economics assume free feedstock through avoided landfill costs" },
            { id: 13, name: "Consumer preference shifts", x: 65, y: 50, radius: 20, category: "market" },
            { id: 14, name: "Price signals for circular materials", x: 60, y: 25, radius: 22, category: "market" }
        ];
        
        // Color scale for categories
        const colorScale = d3.scaleOrdinal()
            .domain(["policy", "technology", "infrastructure", "market"])
            .range(["#4169E1", "#20B2AA", "#3CB371", "#FF8C00"]);
            
        // Draw bubbles
        svg.selectAll(".bubble")
            .data(data)
            .enter()
            .append("circle")
            .attr("class", "bubble")
            .attr("cx", d => xScale(d.x))
            .attr("cy", d => yScale(d.y))
            .attr("r", d => d.radius)
            .attr("fill", d => colorScale(d.category))
            .attr("fill-opacity", 0.7)
            .attr("stroke", d => d3.color(colorScale(d.category)).darker())
            .attr("stroke-width", 2)
            .append("title")
            .text(d => d.name);
            
        // IMPROVED: Add icons to bubbles with better visibility
        svg.selectAll(".bubble-icon")
            .data(data)
            .enter()
            .append("text")
            .attr("class", "bubble-icon")
            .attr("x", d => xScale(d.x))
            .attr("y", d => yScale(d.y))
            .attr("font-size", d => d.radius * 0.7)
            .html(d => {
                switch(d.category) {
                    case "policy": return "âš–"; // law/policy symbol
                    case "technology": return "âš™"; // gear symbol
                    case "infrastructure": return "ðŸ¢"; // building symbol
                    case "market": return "$"; // dollar symbol
                    default: return "?"; // question symbol
                }
            });
            
        // IMPROVED: Add labels to bubbles with better positioning
        svg.selectAll(".bubble-label")
            .data(data)
            .enter()
            .append("text")
            .attr("class", "bubble-label")
            .attr("x", d => {
                // Adjust horizontal position to avoid overlap
                if (d.id === 1) return xScale(d.x);
                if (d.id === 2) return xScale(d.x) - 20;
                if (d.id === 3) return xScale(d.x) + 30;
                if (d.id === 4) return xScale(d.x) + 25;
                if (d.id === 5) return xScale(d.x) - 25;
                if (d.id === 6) return xScale(d.x) - 25;
                if (d.id === 7) return xScale(d.x) - 30;
                if (d.id === 8) return xScale(d.x) + 30;
                if (d.id === 9) return xScale(d.x) - 30;
                if (d.id === 10) return xScale(d.x) + 30;
                if (d.id === 11) return xScale(d.x) + 30;
                if (d.id === 12) return xScale(d.x) - 25;
                if (d.id === 13) return xScale(d.x) + 25;
                if (d.id === 14) return xScale(d.x) + 30;
                return xScale(d.x);
            })
            .attr("y", d => {
                // Adjust vertical position to avoid overlap
                if (d.id === 1) return yScale(d.y) - d.radius - 10;
                if (d.id === 2) return yScale(d.y) - d.radius - 10;
                if (d.id === 3) return yScale(d.y) - d.radius - 10;
                if (d.id === 4) return yScale(d.y) - d.radius - 10;
                if (d.id === 5) return yScale(d.y) + d.radius + 20;
                if (d.id === 6) return yScale(d.y) - d.radius - 10;
                if (d.id === 7) return yScale(d.y) - d.radius - 10;
                if (d.id === 8) return yScale(d.y) - d.radius - 10;
                if (d.id === 9) return yScale(d.y) + d.radius + 15;
                if (d.id === 10) return yScale(d.y) - d.radius - 10;
                if (d.id === 11) return yScale(d.y) - d.radius - 10;
                if (d.id === 12) return yScale(d.y) - d.radius - 10;
                if (d.id === 13) return yScale(d.y) - d.radius - 10;
                if (d.id === 14) return yScale(d.y) - d.radius - 10;
                return yScale(d.y) - d.radius - 10;
            })
            .attr("text-anchor", d => {
                // Adjust text anchor based on position
                if ([2, 5, 6, 7, 9, 12].includes(d.id)) return "end";
                if ([3, 4, 8, 10, 11, 13, 14].includes(d.id)) return "start";
                return "middle";
            })
            .text(d => d.name);
            
        // IMPROVED: Reduced number of annotations and better positioning
        // Only show annotations for key items with important data points
        const annotatedBubbles = [data[0], data[4], data[8], data[11]];
        
        svg.selectAll(".annotation")
            .data(annotatedBubbles)
            .enter()
            .append("text")
            .attr("class", "annotation")
            .attr("x", d => {
                // Adjust horizontal position for specific annotations
                if (d.id === 1) return xScale(d.x);
                if (d.id === 5) return xScale(d.x);
                if (d.id === 9) return xScale(d.x) - 30;
                if (d.id === 12) return xScale(d.x) - 25;
                return xScale(d.x);
            })
            .attr("y", d => {
                // Adjust vertical position for specific annotations
                if (d.id === 1) return yScale(d.y) + d.radius + 20;
                if (d.id === 5) return yScale(d.y) + d.radius + 40;
                if (d.id === 9) return yScale(d.y) + d.radius + 35;
                if (d.id === 12) return yScale(d.y) + d.radius + 15;
                return yScale(d.y) + d.radius + 20;
            })
            .attr("text-anchor", d => {
                if ([9, 12].includes(d.id)) return "end";
                return "middle";
            })
            .each(function(d) {
                const text = d3.select(this);
                const words = d.annotation.split(/\s+/);
                let line = "";
                let lineNumber = 0;
                const lineHeight = 1.2;
                const y = text.attr("y");
                const x = text.attr("x");
                const anchor = text.attr("text-anchor");
                
                // Create multiline annotations with limited width
                let currentLine = [];
                const maxChars = 30;
                let currentChars = 0;
                
                words.forEach(function(word) {
                    if (currentChars + word.length > maxChars) {
                        text.append("tspan")
                            .attr("x", x)
                            .attr("y", y)
                            .attr("text-anchor", anchor)
                            .attr("dy", lineNumber * lineHeight + "em")
                            .text(currentLine.join(" "));
                        currentLine = [word];
                        currentChars = word.length;
                        lineNumber++;
                    } else {
                        currentLine.push(word);
                        currentChars += word.length + 1;
                    }
                });
                
                if (currentLine.length > 0) {
                    text.append("tspan")
                        .attr("x", x)
                        .attr("y", y)
                        .attr("text-anchor", anchor)
                        .attr("dy", lineNumber * lineHeight + "em")
                        .text(currentLine.join(" "));
                }
            });
            
        // IMPROVED: Better source attribution
        svg.append("text")
            .attr("class", "source")
            .attr("x", 0)
            .attr("y", height + 80)
            .text("Source: Analysis based on data from PlasticsEurope, Science Advances, Soares et al. 2022");
            
        // IMPROVED: Better legend with clearer icons and labels
        const legend = svg.append("g")
            .attr("class", "legend")
            .attr("transform", `translate(${width + 20}, 20)`);
            
        legend.append("text")
            .attr("class", "legend-title")
            .attr("x", 0)
            .attr("y", 0)
            .text("Categories");
            
        const categories = ["policy", "technology", "infrastructure", "market"];
        const categoryLabels = ["Policy", "Technology", "Infrastructure", "Market"];
        const categoryIcons = ["âš–", "âš™", "ðŸ¢", "$"];
        
        categories.forEach((category, i) => {
            const g = legend.append("g")
                .attr("transform", `translate(0, ${i * 30 + 25})`);
                
            g.append("circle")
                .attr("r", 10)
                .attr("fill", colorScale(category))
                .attr("fill-opacity", 0.7)
                .attr("stroke", d3.color(colorScale(category)).darker())
                .attr("stroke-width", 2);
                
            // Add icon to legend
            g.append("text")
                .attr("x", 0)
                .attr("y", 0)
                .attr("dy", "0.35em")
                .attr("text-anchor", "middle")
                .attr("fill", "white")
                .attr("font-weight", "bold")
                .text(categoryIcons[i]);
                
            g.append("text")
                .attr("class", "legend-item")
                .attr("x", 20)
                .attr("y", 0)
                .attr("dy", "0.35em")
                .text(categoryLabels[i]);
        });
    </script>
</body>
</html>